# AWS VPC Setup with Public Subnets (AWS CLI)

This document explains how to create and configure a **VPC with public subnets** using the AWS CLI.  
Each command includes an explanation for clarity.  

---

## 1. Create a VPC

```bash
VPC_ID=$(aws ec2 create-vpc \
  --cidr-block 10.0.0.0/16 \
  --region us-east-1 \
  --query "Vpc.VpcId" \
  --output text)

aws ec2 create-tags \
  --resources $VPC_ID \
  --tags Key=Name,Value=MyVPC \
  --region us-east-1

echo "Created VPC with ID: $VPC_ID"

```
## Explanation:

- Creates a new VPC with CIDR block 10.0.0.0/16.

- Restricts the VPC to the us-east-1 region.

- The --query and --output text flags return only the VPC ID.

### Example Output:

```
vpc-022d831ccf7b2ca17
```
## 2. Enable DNS Support and Hostnames


- Enable DNS support
```
aws ec2 modify-vpc-attribute \
  --vpc-id $VPC_ID \
  --region us-east-1 \
  --enable-dns-support
```
- Enable DNS hostnames
```
aws ec2 modify-vpc-attribute \
  --vpc-id $VPC_ID \
  --region us-east-1 \
  --enable-dns-hostnames
```




## Explanation:

- Enables DNS resolution and assigns hostnames to instances in the VPC.

- Required for instances to be reachable via domain names.

## 3. Create and Attach an Internet Gateway

```   
IGW_ID=$(aws ec2 create-internet-gateway \
  --region us-east-1 \
  --query "InternetGateway.InternetGatewayId" \
  --output text)
```

- To check IGW IG:
```
echo "Created and attached IGW: $IGW_ID"
```

## Attach the Internet Gateway to the VPC:
```
aws ec2 attach-internet-gateway \
  --vpc-id $VPC_ID \
  --region us-east-1 \
  --internet-gateway-id $IGW_ID

```

## 4. Create a Route Table
```
RTB_ID=$(aws ec2 create-route-table \
  --vpc-id $VPC_ID \
  --region us-east-1 \
  --query "RouteTable.RouteTableId" \
  --output text)
```

- Add a default route (0.0.0.0/0) to the Internet Gateway:
```
aws ec2 create-route \
  --route-table-id $RTB_ID \
  --destination-cidr-block 0.0.0.0/0 \
  --region us-east-1 \
  --gateway-id $IGW_ID
```
- To check Route ID:

```
echo "Created Route Table: $RTB_ID"
```

## 5. Create Public Subnets
- Create Public Subnet-1:
```
SUBNET1_ID=$(aws ec2 create-subnet \
  --vpc-id $VPC_ID \
  --cidr-block 10.0.1.0/24 \
  --availability-zone us-east-1a \
  --region us-east-1 \
  --query "Subnet.SubnetId" \
  --output text)
```
- Create Public Subnet-2:
```
SUBNET2_ID=$(aws ec2 create-subnet \
  --vpc-id $VPC_ID \
  --cidr-block 10.0.2.0/24 \
  --availability-zone us-east-1b \
  --region us-east-1 \
  --query "Subnet.SubnetId" \
  --output text)
```
- echo "Created Subnets: $SUBNET1_ID, $SUBNET2_ID"





## 6. Associate Subnets with Route Table
- Associate Subnets 1
```
aws ec2 associate-route-table \
  --subnet-id $SUBNET1_ID \
  --region us-east-1 \
  --route-table-id $RTB_ID
```
- Associate Subnets 2
```
aws ec2 associate-route-table \
  --subnet-id $SUBNET2_ID \
  --region us-east-1 \
  --route-table-id $RTB_ID
```

## Explanation:

- Associates both subnets with the route table, enabling them to use the Internet Gateway.

## 7. Enable Auto-Assign Public IP on Subnets
- Enable Auto-Assign Public IP subnet - 1
```
aws ec2 modify-subnet-attribute \
  --subnet-id $SUBNET1_ID \
  --map-public-ip-on-launch \
  --region us-east-1
```
- Enable Auto-Assign Public IP subnet - 2
```
aws ec2 modify-subnet-attribute \
  --subnet-id $SUBNET2_ID \
  --map-public-ip-on-launch \
  --region us-east-1
```
## 8. Create-security-group

### Create Worker Node Security Group
```
WORKER_SG_ID=$(aws ec2 create-security-group \
  --group-name eks-worker-nodes-sg \
  --description "EKS Worker Nodes Security Group" \
  --vpc-id $VPC_ID \
  --region us-east-1 \
  --query "GroupId" \
  --output text)
```
- WORKER_SG_ID
```
echo "Created Worker Node SG: $WORKER_SG_ID"
```
### Allow inbound from Cluster SG (control plane -> kubelet on nodes)
```
aws ec2 authorize-security-group-ingress \
  --group-id $WORKER_SG_ID \
  --protocol tcp \
  --port 443 \
  --source-group $CLUSTER_SG_ID \
  --region us-east-1
```
### Allow all traffic between worker nodes themselves (pod-to-pod, node-to-node)
```
aws ec2 authorize-security-group-ingress \
  --group-id $WORKER_SG_ID \
  --protocol -1 \
  --source-group $WORKER_SG_ID \
  --region us-east-1
```

### (Optional) Allow NodePort range for services

```aws ec2 authorize-security-group-ingress \
  --group-id $WORKER_SG_ID \
  --protocol tcp \
  --port 30000-32767 \
  --cidr 0.0.0.0/0 \
  --region us-east-1
```




- To check Security Group ID:

```
echo "Created Security Group: $CLUSTER_SG_ID"
```

## Explanation:

- Ensures that new EC2 instances launched in these subnets automatically receive a public IP.
