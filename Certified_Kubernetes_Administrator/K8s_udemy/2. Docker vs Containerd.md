# Docker vs Containerd: A Deep Dive with CLI Tools

You're going to come across **Docker** and **Containerd** many times while working with containers and Kubernetes. This document breaks down the history, differences, and CLI tools you'll encounter like `ctr`, `crictl`, and `nerdctl`.

---

## 🚀 The Container Era: A Quick History

### The Beginning

- In the beginning, there was **Docker**.
- Other tools existed (e.g., `rkt`), but Docker’s user experience made it dominant.
- Docker simplified working with containers.

### Kubernetes Enters

- Kubernetes was initially built **specifically to orchestrate Docker**.
- Back then, Kubernetes only supported Docker as its container runtime.

### Need for More Runtimes

- As Kubernetes grew, there was a demand to support other runtimes.
- Kubernetes introduced the **Container Runtime Interface (CRI)**.

---

## 🧩 CRI and OCI

### What is CRI?

- **CRI** = Container Runtime Interface.
- Allows Kubernetes to work with any container runtime that follows standards.

### What is OCI?

- **OCI** = Open Container Initiative.
- Defines:
  - `imagespec`: how images should be built.
  - `runtimespec`: how a container runtime should operate.

> Any runtime following OCI specs can be used with Kubernetes via CRI.

---

## 🐳 Docker’s Challenge with CRI

- Docker was built **before** CRI existed and didn’t follow it.
- Kubernetes introduced a workaround called **dockershim**.
- This allowed Kubernetes to support Docker **outside of CRI**.

---

## 🧱 The Docker Stack

Docker isn’t just a runtime; it includes:

- Docker CLI
- Docker API
- Build tools
- Volumes, authentication, security features
- **runC** (container runtime)
- **Containerd** (manages runC)

### ✅ Containerd Is CRI-Compatible

- **Containerd** is a CRI-compatible runtime and can be used **without Docker**.

---

## ⚠️ Kubernetes Deprecates Docker

- **Kubernetes 1.24** removed `dockershim`.
- Docker is no longer a supported runtime.
- Existing **Docker-built images still work**, since Docker follows OCI `imagespec`.

---

## 📦 What Is Containerd?

- Originally part of Docker.
- Now a **CNCF graduated project**.
- Can be installed **independently** of Docker.

---

## 🧰 CLI Tools Overview

Let’s explore the CLI tools you'll use with Containerd and Kubernetes.

---

## 🧪 `ctr`: The Containerd CLI

- Comes with Containerd.
- Mainly for **debugging purposes**.
- **Not user-friendly** and supports limited features.
- Often used internally or in documentation for testing/debugging.

### 🧪 Basic Commands

```bash
# Pull Redis image
ctr images pull docker.io/library/redis:latest

# Run container
ctr run --rm -t docker.io/library/redis:latest redis-instance /bin/sh
```

## 🧠 nerdctl: Docker-like CLI for Containerd
   - Recommended CLI tool for general-purpose use.
   - Developed by the Containerd community.
   - Mimics Docker CLI in syntax and functionality.
   - Supports additional features not yet in Docker.

## 🆕 Features Supported
   - Encrypted container images
   - Lazy pulling of images
   - P2P image distribution
   - Image signing and verifying
   - Kubernetes-style namespaces
## 🧪 Sample Usage
```bash
 # Run Redis container
 nerdctl run -d -p 6379:6379 redis

 # List containers
 nerdctl ps

 # Pull image
 nerdctl pull nginx

```

## 🔍 `crictl`: CRI CLI Tool

- Developed by the **Kubernetes community**.
- Works with **all CRI-compatible runtimes** (e.g., Containerd, rkt).
- Mostly used for **debugging**, not for container management.

> ⚠️ **Note**:  
> Creating containers with `crictl` is technically possible, but **not recommended**.  
> Containers created directly with `crictl` may be **deleted by `kubelet`**, as it is unaware of them.

---

### 🧪 Sample `crictl` Commands

```bash
# List containers
crictl ps

# Pull image
crictl pull nginx

# View logs
crictl logs <container-id>

# Exec inside a container
crictl exec -it <container-id> /bin/sh

# List pods (aware of Kubernetes pods)
crictl pods
```
## 🆚 CLI Tool Comparison

| Feature           | `ctr`         | `nerdctl`        | `crictl`            |
|-------------------|---------------|------------------|---------------------|
| Developed by      | Containerd    | Containerd       | Kubernetes          |
| Purpose           | Debugging     | General-purpose  | Debugging           |
| Docker-like       | ❌            | ✅               | ❌                  |
| CRI Compatible     | ✅            | ✅               | ✅                  |
| Runtime Support   | Containerd    | Containerd       | All CRI Runtimes    |

---

## 🧾 `crictl` Endpoint Changes in Kubernetes 1.24+

Prior to Kubernetes v1.24, `crictl` connected to runtime endpoints in the following order:

```plaintext
/var/run/dockershim.sock
/run/containerd/containerd.sock
```

From Kubernetes v1.24, due to the removal of dockershim, the Docker socket was replaced with:

```
/var/run/cri-dockerd.sock
```
## 📌 These changes are documented in the Kubernetes cri-tools GitHub repository:

GitHub PR #869 - ``` https://github.com/kubernetes-sigs/cri-tools/pull/869```

GitHub Issue #868 - ``` https://github.com/kubernetes-sigs/cri-tools/issues/868 ```

## 📌 Summary

| Tool      | Purpose           | Origin       | Usage Level           |
|-----------|-------------------|--------------|------------------------|
| `ctr`     | Debugging         | Containerd   | Limited, low-level     |
| `nerdctl` | Docker-like CLI   | Containerd   | Recommended CLI        |
| `crictl`  | Debugging (CRI)   | Kubernetes   | Runtime-agnostic       |

---

## 📚 Final Notes

- ✅ **Use `nerdctl`** for general container management with Containerd.
- 🛠️ **Use `crictl`** for debugging containers in a Kubernetes context.
- 🚫 **Avoid `ctr`** unless you're doing low-level internal Containerd debugging.
